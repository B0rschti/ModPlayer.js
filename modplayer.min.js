!function(a){"use strict";Array.from||(Array.from=function(a){return[].slice.call(a)});var b,c=a.mp;b=a.mp={},b.noConflict=function(){return a.mp=c,b},b.loadModule=function(a,c,d){c=Array.from(arguments).slice(1),d=c.pop(),b.util.get(a,"arraybuffer",function(a,e){d(a,a?null:b.module.apply(null,[e].concat(c)))})}}(window),function(mp){"use strict";var util=mp.util={};util.constant=function(a){return function(){return a}},util.extend=function(a,b){for(var c in b)a[c]=b[c];return a},util.flatten=function(a){return[].concat.apply([],a)},util.range=function(a){return Array.apply(null,new Array(a)).map(function(a,b){return b})},util.get=function(url,type,done){done||(done=type,type="json");var isText="text"===type||!type,isJSON="json"===type,xhr=util.extend(new XMLHttpRequest,{responseType:isJSON?"":type,onload:function(){done(null,isText?xhr.responseText:isJSON?eval("("+xhr.responseText+")"):xhr.response)},onerror:function(){done(xhr)}});xhr.open("GET",url),xhr.send()}}(window.mp),function(a){"use strict";var b=a.format={},c=a.util,d=[];b.register=function(a,c){d.push(a),c&&(b["parse"+c]=a)},b.parseModule=function(a){for(var b=null,c=0;!b&&c<d.length;)b=d[c++](a);return b},b.bytesIter=function(a,b){function d(){return b}function e(a){return b+=Math.abs(a),i}function f(c){return String.fromCharCode.apply(null,a.subarray(b,b+=c))}function g(d,e){e=e===!0;var f=c.range(d).reduce(function(c,f){var g=a[b+f];return e&&f+1!==d||(g&=255),c+(g<<8*f)},0);return b+=d,f}function h(){return(i.byte()<<8)+i.byte()}b=b||0;var i={pos:d,step:e,str:f},j={"byte":1,word:2,dword:4};return i.word_bigEndian=h,Object.keys(j).forEach(function(a){i[a]=g.bind(null,j[a])}),i}}(window.mp),function(a){"use strict";function b(b){if(!c(b))return null;var f=a.format.bytesIter(b),h=d(f);return k.extend(h,{patterns:j(e,h.patterns,f,h.numChannels),instruments:j(g,h.instruments,f)})}function c(b){return"Extended Module: "===a.format.bytesIter(b).str(17)}function d(a){var b={id:a.str(17),title:a.str(20).trim(),tracker:a.step(1).str(20).trim(),ver:a.word(),patternOrder:a.step(4).word(),restart:a.word(),numChannels:a.word(),patterns:a.word(),instruments:a.word(),freqTable:1&a.word()?"linear":"amiga",tempo:a.word(),speed:a.word()};return b.patternOrder=k.range(256).map(a.byte).slice(0,b.patternOrder),b}function e(a,b){var c;return a.step(5),c=a.word(),a.step(2),k.flatten(j(f,c*b,a))}function f(a){var b,c,d,e,f,g=a.byte();return 128&g?(b=c=d=e=f=0,1&g&&(b=a.byte()),2&g&&(c=a.byte()),4&g&&(d=a.byte()),8&g&&(e=a.byte()),16&g&&(f=a.byte())):(b=g,c=a.byte(),d=a.byte(),e=a.byte(),f=a.byte()),[b,c,d,e,f]}function g(a){function b(b){return b.data=i(a,b.data,b.is16),b}var c={},d=a.pos(),e=a.dword(),f=a.str(22).trim(),g=a.step(1).word();return g>0&&(a.step(4),c={sampleMapping:k.range(96).map(a.byte),volumeEnvelope:k.range(24).map(a.word),panningEnvelope:k.range(24).map(a.word),volumeEnvelopePoints:a.byte(),panningEnvelopePoints:a.byte(),volumeEnvelopeSustainPoint:a.byte(),volumeEnvelopeLoopStartPoint:a.byte(),volumeEnvelopeLoopEndPoint:a.byte(),panningEnvelopeSustainPoint:a.byte(),panningEnvelopeLoopStartPoint:a.byte(),panningEnvelopeLoopEndPoint:a.byte(),volumeType:a.byte(),panningType:a.byte(),vibratoType:a.byte(),vibratoSweep:a.byte(),vibratoDepth:a.byte(),vibratoRate:a.byte(),volumeFadeOut:a.word()},a.step(e-(a.pos()-d)),c.samples=j(h,g,a).map(b)),c.name=f,c}function h(a){var b={data:a.dword(),loopStart:a.dword(),loopLength:a.dword(),volume:a.byte(),finetune:a.byte(!0),loopType:a.byte(),panning:a.byte(),relnote:a.byte(!0),name:a.step(1).str(22).trim()},c=3&b.loopType;return b.is16=!!(16&b.loopType),b.loopType=c?1===c?"forward":"ping-pong":null,b}function i(a,b,c){c&&(b/=2);var d=c?a.word:a.byte,e=0;return k.range(b).map(function(){return e+=d(),e&=c?65535:255,c?e>=32768&&(e-=65536):e>=128&&(e-=256),e})}function j(a,b){var c=Array.from(arguments).slice(2);return k.range(b).map(function(){return a.apply(this,c)})}var k=a.util;a.format.register(b,"XModule")}(window.mp),function(a){"use strict";function b(b){var d=a.format.bytesIter(b),g={title:d.str(20).trim(),speed:125,tempo:6};g.instruments=h(c,31,d);var i=d.byte();d.step(1);var j=a.util.range(128).map(d.byte);g.patternOrder=j.slice(0,i),g.id=d.str(4),g.numChannels=e(g.id);var k=Math.max.apply(null,j)+1;return g.patterns=a.util.range(k).map(function(){return a.util.flatten(h(f,64*g.numChannels,d))}),g.instruments.forEach(function(b){if(b.samples){var c=b.samples[0];c.data=a.util.range(c.sampLen).map(function(){var a=d.byte();return a>=128&&(a-=256),a})}}),g}function c(b){var c={},e=b.str(22).trim(),f=d(b);if(f.sampLen>2){var g=a.util.constant(0);c={sampleMapping:i.range(96).map(g),volumeEnvelope:i.range(24).map(g),panningEnvelope:i.range(24).map(g),volumeEnvelopePoints:0,panningEnvelopePoints:0,volumeEnvelopeSustainPoint:0,volumeEnvelopeLoopStartPoint:0,volumeEnvelopeLoopEndPoint:0,panningEnvelopeSustainPoint:0,panningEnvelopeLoopStartPoint:0,panningEnvelopeLoopEndPoint:0,volumeType:0,panningType:0,vibratoType:0,vibratoSweep:0,vibratoDepth:0,vibratoRate:0,volumeFadeOut:0},c.samples=[f]}return c.name=e,c}function d(a){var b={sampLen:2*a.word_bigEndian(),finetune:j[15&a.byte()],volume:a.byte(),loopStart:2*a.word_bigEndian(),loopLength:2*a.word_bigEndian(),panning:128,relnote:0};return b.loopType=b.loopEnd>2?"forward":null,b}function e(a){return{"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,OKTA:8,OCTA:8,FA08:8,CD81:8}[a]||parseInt(/(\d+)CH/.exec(a)[1],10)}function f(a){var b,c,d,e=a.byte(),f=a.byte(),h=a.byte(),i=a.byte();return b=((15&e)<<8)+f,c=(240&e)+(h>>4),d=15&h,b=g(b),1!=d||i||(d=0),2!=d||i||(d=0),10!=d||i||(d=0),5!=d||i||(d=3),6!=d||i||(d=4),[b,c,0,d,i]}function g(a){for(var b=0;120>b;b++){var c=16*k[b%12]>>b/12>>2;if(a>=c)return b+1}return 0}function h(a,b){var c=Array.from(arguments).slice(2);return i.range(b).map(function(){return a.apply(this,c)})}var i=a.util;a.format.register(b,"PTModule");var j=[0,16,32,48,64,80,96,112,-128,-112,-96,-80,-64,-48,-32,-16],k=[1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,907]}(window.mp),function(a){"use strict";a.instrument=function(b,c,d){function e(a){return m[d.sampleMapping[a-1]]}function f(a,b,c){var d=a/l*(b/64)*(c/64);return d}function g(a,b){var c=a+(b-32)*(128-Math.abs(a-128))/32;return 0>c?c=0:c>255&&(c=255),c/255}function h(a,c,d,e,f,g,h){var i=e*Math.cos(Math.PI/2*f),j=e*Math.sin(Math.PI/2*f);i!=d.volumeLeft&&(null==d.volumeLeft?(a.gain.value=0,b.smoothlySetValueAtTime(a.gain,0,i,g,h)):b.smoothlySetValueAtTime(a.gain,d.volumeLeft,i,g,h),d.volumeLeft=i),j!=d.volumeRight&&(null==d.volumeRight?(c.gain.value=0,b.smoothlySetValueAtTime(c.gain,0,j,g,h)):b.smoothlySetValueAtTime(c.gain,d.volumeRight,j,g,h),d.volumeRight=j)}function i(a,b,f,g,h,i,j,k){var l=e(b);if(null==a&&(a={},d.vibratoRate&&d.vibratoDepth&&(a.autoVibratoPos=0,d.vibratoSweep&&(a.autoVibratoSweepPos=0))),null!=f&&(a.arpeggio=f,a.arpeggioPos=0),null!=g)if(a.portamento=g,a.portamentoPos=0,null!=h){var m=e(h);a.portamentoTarget=m.getBasePlaybackRate()*Math.pow(2,(h-49)/12),a.portamentoTarget<a.basePlaybackRate?a.portamento>0&&(a.portamento*=-1):a.portamento<0&&(a.portamento*=-1)}else a.portamentoTarget=null;var n=a.basePlaybackRate;if(null==n&&(n=l.getBasePlaybackRate(),n*=Math.pow(2,(b-49)/12),a.basePlaybackRate=n),null!=a.arpeggio&&(n=a.arpeggioPos%3==1?a.basePlaybackRate*Math.pow(2,(15&a.arpeggio)/12):a.arpeggioPos%3==2?a.basePlaybackRate*Math.pow(2,(240&a.arpeggio)/16/12):a.basePlaybackRate,++a.arpeggioPos,a.arpeggioPos>=c&&(a.arpeggio=null)),null!=a.portamento&&(++a.portamentoPos,a.portamentoPos>=c?a.portamento=null:(a.basePlaybackRate*=Math.pow(2,a.portamento/16/12),null!=a.portamentoTarget&&(a.basePlaybackRate<=a.portamentoTarget&&a.portamento<0||a.basePlaybackRate>=a.portamentoTarget&&a.portamento>0)&&(a.basePlaybackRate=a.portamentoTarget,a.portamento=null))),d.vibratoRate&&d.vibratoDepth){var o=Math.sin(2*Math.PI*a.autoVibratoPos/256),p=o*d.vibratoDepth/64;d.vibratoSweep&&(p*=a.autoVibratoSweepPos/d.vibratoSweep),n*=Math.pow(2,p/12),a.autoVibratoPos+=d.vibratoRate,d.vibratoSweep&&a.autoVibratoSweepPos<d.vibratoSweep&&++a.autoVibratoSweepPos}if(n!=a.playbackRate){null==a.playbackRate?i.playbackRate.value=n:i.playbackRate.setValueAtTime(n,j),a.playbackRate=n}return a}function j(a,b,i,j,k,m,o,s,t){var u=e(b),v=97==b;null==a&&(a={fadeVolume:l,volumeSlide:0,envelopePos:0,panningEnvelopePos:0,keyOff:!1}),v?a.keyOff=!0:b>=1&&96>=b&&(a.keyOff=!1,a.fadeVolume=l),null!=i&&(a.envelopePos=0),null!=j&&(a.volumeSlide=j,a.volumeSlidePos=0),null!=k&&(a.envelopePos=k),null!=m&&(a.panningEnvelopePos=0);var w=m;null==w&&(w=null!=a.notePanning?a.notePanning:u.getBasePanning()),a.notePanning=w;var x;if(0==(1&d.panningType))x=g(w,32);else{var z=y[a.panningEnvelopePos];null==z&&(z=a.envelopePanning),null==z&&(z=32),a.envelopePanning=z,x=g(w,z),a.panningEnvelopePos!=A&&(++a.panningEnvelopePos,a.panningEnvelopePos==C&&(a.panningEnvelopePos=C))}var B=i;if(null==B&&(B=null!=a.noteVolume?a.noteVolume:u.getBaseVolume()),a.noteVolume=B,0==(1&d.volumeType)){var D=v?0:f(l,B,64);h(o,s,a,D,x,t)}else{var E=n[a.envelopePos];null==E&&(E=a.envelopeVolume),null==E&&(E=64),a.envelopeVolume=E;var D=f(a.fadeVolume,B,E);h(o,s,a,D,x,t),(a.keyOff||a.envelopePos!=p)&&(++a.envelopePos,a.envelopePos==r&&(a.envelopePos=q)),a.keyOff&&(a.fadeVolume-=d.volumeFadeOut,a.fadeVolume<0&&(a.fadeVolume=0))}if(null!=a.volumeSlide){++a.volumeSlidePos;var F=a.volumeSlide,G=c;Math.abs(F)<1&&(F*=256,G=2),a.volumeSlidePos>=G?a.volumeSlide=null:(a.noteVolume+=F,a.noteVolume<0?a.noteVolume=0:a.noteVolume>64&&(a.noteVolume=64))}return a}function k(a,c,d,e,f){b.smoothlySetValueAtTime(c.gain,a.volumeLeft,0,f),b.smoothlySetValueAtTime(d.gain,a.volumeRight,0,f),e.stop(f+b.smoothingTime),--window.playingNotes}var l=32767,m=[];d.samples&&(m=d.samples.map(a.sample.bind(null,b.audioContext)));var n=[],o=d.volumeEnvelopePoints||0,p=-1,q=-1,r=-1;if(1&d.volumeType)for(var s=-1,t=64,u=0;o>u;++u){for(var v=d.volumeEnvelope[2*u],w=d.volumeEnvelope[2*u+1],x=s+1;v>x;++x)n[x]=t+(w-t)*(x-s)/(v-s);n[v]=w,d.volumeEnvelopeSustainPoint==u&&2&d.volumeType&&(p=v),d.volumeEnvelopeLoopStartPoint==u&&4&d.volumeType&&(q=v),d.volumeEnvelopeLoopEndPoint==u&&4&d.volumeType&&(r=v),s=v,t=w}var y=[],z=d.panningEnvelopePoints||0,A=-1,B=-1,C=-1;if(1&d.panningType)for(var s=-1,t=32,u=0;z>u;++u){for(var v=d.panningEnvelope[2*u],w=d.panningEnvelope[2*u+1],x=s+1;v>x;++x)y[x]=t+(w-t)*(x-s)/(v-s);y[v]=w,d.panningEnvelopeSustainPoint==u&&2&d.panningType&&(A=v),d.panningEnvelopeLoopStartPoint==u&&4&d.panningType&&(B=v),d.panningEnvelopeLoopEndPoint==u&&4&d.panningType&&(C=v),s=v,t=w}return{getSample:e,doFrequencyTick:i,doVolumeTick:j,stopNoteAtTime:k}}}(window.mp),function(a){"use strict";function b(a){function b(a,b,d,e,f){null==f&&(f=1),null==b?a.setValueAtTime(d,e):(a.setValueAtTime(b,e),a.linearRampToValueAtTime(d,e+c*f))}var c=.004;return{smoothlySetValueAtTime:b,audioContext:a,smoothingTime:c}}a.module=function(c,d){function e(b,d){if(null!=c&&null==m){var e=g.audioContext.createGain();e.gain.value=.75,e.connect(b);var f=null;m=g.audioContext.currentTime+.03,l=m;var k,o=m,p=0,q=null,r=2,s=0,t=function(){var b=g.audioContext.currentTime;null==q&&(q=a.pattern(g,e,n,i,j,h,c.patterns[c.patternOrder[p]]));var d=q;if(f=d.playPattern(f,o,b,r),s+=d.getProcessedRows(f),o=d.getPatternEndTime(f),d.isFinished(f)&&(q=null,++p,p>=c.patternOrder.length&&(p=c.restart?c.restart:0),r>s))return void t();var l=o-m,u=.5*l+(m-b);window.setTimeout(k,1e3*u),m=o},k=t;null!=d&&(k=function(){d(t)}),t()}}function f(a){if(null==m)return null;var b=g.audioContext.currentTime,c=1,d=k*c;if(null==a||b>a){var e=Math.round((m-l)/k);l=m-(e%c+c-.25)*k;var f=Math.round((b-l)/d);a=l+(f+1)*d}return a}c=a.format.parseModule(new Int8Array(c));var g=b(d),h=c.numChannels,i=2.5/c.speed,j=c.tempo,k=i*j,l=null,m=null,n=c.instruments.map(a.instrument.bind(null,g,j));return{play:e,syncWithAudio:f}}}(window.mp),function(a){"use strict";a.pattern=function(a,b,c,d,e,f,g){function h(){var c=a.audioContext.createGain();c.connect(b);for(var d={masterGainNode:c,channels:[],rowIndex:0,loopStartRow:0,loopCounter:0},e=0;f>e;++e){var g=a.audioContext.createChannelMerger(2),h=a.audioContext.createGain();g.connect(h),h.connect(c),d.channels.push({channelMasterGainNode:h,channelMergerNode:g,playingNotes:[]})}return d}function i(a,b,c){return null==a&&(a=h()),a.channels[b].channelMasterGainNode.setValueAtTime(0,c),a}function j(a,b,c){return null==a&&(a=h()),a.channels[b].channelMasterGainNode.setValueAtTime(1,c),a}function k(a){if(null!=a)for(var b=0;f>b;++b)for(var c=a.channels[b],d=c.playingNotes.length,e=0;d>e;++e){var g=c.playingNotes[e];g.stopped||(g.sourceNode.stop(time),g.stopped=!0)}}function l(a,b){for(var c=0;f>c;++c){for(var d=a.channels[c],e=d.playingNotes.length,g=0,h=1;e>h;++h){var i=d.playingNotes[h];i.startTime<b&&(g=h)}g>0&&d.playingNotes.splice(0,g)}}function m(b,i,j,k){null==b?b=h():l(b,j),b.processedRows=0,k||(k=1e3);for(var m=5,n=m*f,o=g.length/n,p=0;b.rowIndex<o&&b.processedRows<k;){var q=i+p*d,r=e,s=b.globalVolume;null==s&&(s=64);for(var t=null,u=0;f>u;++u){var v=b.channels[u],w=b.rowIndex*n+u*m,x=g[w+3],y=g[w+4];if(16==x)s=y,s>64&&(s=64);else if(17==x)0==y&&v.globalVolumeSlideMemory&&(y=v.globalVolumeSlideMemory),y&&(t=(240&y)/16,0==t&&(t=-(15&y)),v.globalVolumeSlideMemory=y);else if(14==x&&224==(240&y)){var z=((15&y)+1)*e;z>r&&(r=z)}var A=v.playingNotes.length,B=g[w],C=g[w+1];if(0==B?0!=C&&v.noteMemory&&(B=v.noteMemory):B>=1&&96>=B&&(v.noteMemory=B),B>=1&&96>=B&&3!=x){var D=c[C-1],E=D.getSample(B);if(A>0){var F=v.playingNotes[A-1];F.stopped||(F.instrument.stopNoteAtTime(F.volumeState,F.leftGainNode,F.rightGainNode,F.sourceNode,q),F.stopped=!0)}var F={instrument:D,sourceNode:E.createSampleSourceNode(),leftGainNode:a.audioContext.createGain(),rightGainNode:a.audioContext.createGain()};F.leftGainNode.connect(v.channelMergerNode,0,0),F.rightGainNode.connect(v.channelMergerNode,0,1),F.sourceNode.connect(F.leftGainNode),F.sourceNode.connect(F.rightGainNode);var G=0;9==x&&(0==y&&v.sampleOffsetMemory&&(y=v.sampleOffsetMemory),y&&(G=E.getSampleOffsetInSeconds(256*y),v.sampleOffsetMemory=y)),F.sourceNode.start(q,G),v.playingNotes.push(F)}}for(var H=0;r>H;++H){var I=i+p*d,J=i+(p+1)*d;null!=s&&s!=b.globalVolume&&(null==b.globalVolume?b.masterGainNode.gain.value=s/64:b.masterGainNode.gain.setValueAtTime(s/64,I),b.globalVolume=s),null!=t&&(s+=t,0>s?s=0:s>64&&(s=64));for(var u=0;f>u;++u){var v=b.channels[u],w=b.rowIndex*n+u*m,A=v.playingNotes.length;if(A>0){var F=v.playingNotes[A-1],B=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null;if(0==H){B=g[w];var C=g[w+1];0==B&&0!=C&&v.noteMemory&&(B=v.noteMemory),K=g[w+2],K>=16&&96>K?(K-=16,K>64&&(K=64)):(128==(240&K)?P=-(15&K)/256:192==(240&K)&&(L=15&K,L+=16*L),K=null);var R=g[w+3],S=g[w+4];0==R?S&&(M=S):1==R?(0==S&&v.portamentoUpMemory&&(S=v.portamentoUpMemory),S&&(N=S,v.portamentoUpMemory=S)):2==R?(0==S&&v.portamentoDownMemory&&(S=v.portamentoDownMemory),S&&(N=-S,v.portamentoDownMemory=S)):3==R?(null==B?O=v.portamentoTargetMemory:(O=B,v.portamentoTargetMemory=B),0==S&&v.portamentoMemory&&(S=v.portamentoMemory),S&&(N=S,v.portamentoMemory=S)):10==R?(0==S&&v.volumeSlideMemory&&(S=v.volumeSlideMemory),S&&(P=(240&S)/16,0==P&&(P=-(15&S)),v.volumeSlideMemory=S)):12==R?(K=S,K>64&&(K=64)):21==R&&(Q=S)}F.frequencyState=F.instrument.doFrequencyTick(F.frequencyState,B,M,N,O,F.sourceNode,I,J),F.volumeState=F.instrument.doVolumeTick(F.volumeState,B,K,P,Q,L,F.leftGainNode,F.rightGainNode,I,J)}}++p}for(var u=0;f>u;++u){var v=b.channels[u],w=b.rowIndex*n+u*m,x=g[w+3];if(14==x){var y=g[w+4];if(96==(240&y)){var T=15&y;0==T?b.loopStartRow=b.rowIndex:b.loopCounter<T?(++b.loopCounter,b.rowIndex=b.loopStartRow-1):b.loopCounter=0}}}++b.rowIndex,++b.processedRows}return b.rowIndex==o&&(b.rowIndex=0),b.endTime=i+p*d,b}function n(a){return a.endTime}function o(a){return a.processedRows}function p(a){return 0==a.rowIndex}return{playPattern:m,getPatternEndTime:n,getProcessedRows:o,isFinished:p,muteChannel:i,unmuteChannel:j,stopPlayingImmediately:k}}}(window.mp),function(a){"use strict";a.sample=function(a,b){function c(){if(null==o)return null;var b=a.createBufferSource();if(b.buffer=o,0!=n){var c=o.duration;b.loop=!0,b.loopStart=m/h*c,b.loopEnd=(m+n)/h*c}return b}function d(){return l}function e(){return b.volume}function f(){return b.panning}function g(a){return a/h*o.duration}var h,i=8363,j=22050,k=j>i?j:i,l=i/k,m=b.loopStart,n=b.loopLength,o=null,p=b.relnote;p>=128&&(p-=256);var q=b.finetune;q>=128&&(q-=256),l*=Math.pow(2,p/12),l*=Math.pow(2,q/128/12);var r=b.data;h=r.length,o=a.createBuffer(1,h,k);for(var s=o.getChannelData(0),t=b.is16?32768:128,u=0;h>u;++u)s[u]=r[u]/t;return{createSampleSourceNode:c,getBasePlaybackRate:d,getBaseVolume:e,getBasePanning:f,getSampleOffsetInSeconds:g}}}(window.mp);