!function(a){"use strict";function b(a){c.util.extend(this,c.format.parseModule(new Int8Array(a)))}Array.from||(Array.from=function(a){return[].slice.call(a)});var c,d=a.ModPlayer;c=a.ModPlayer=b,c.noConflict=function(){return a.ModPlayer=d,c},c.get=function(a,d){c.util.get(a,"arraybuffer",function(a,c){d(a,a?null:new b(c))})}}(window),function(mp){"use strict";var util=mp.util={};util.constant=function(a){return function(){return a}},util.extend=function(a,b){for(var c in b)a[c]=b[c];return a},util.flatten=function(a){return[].concat.apply([],a)},util.pick=function(a,b){return Array.isArray(b)||(b=Array.from(arguments).slice(1)),b.reduce(function(b,c){return b[c]=a[c],b},{})},util.range=function(a){return Array.apply(null,new Array(a)).map(function(a,b){return b})},util.startsWith=function(a,b){return 0===a.indexOf(b)},util.get=function(url,type,done){done||(done=type,type="json");var isText="text"===type||!type,isJSON="json"===type,xhr=util.extend(new XMLHttpRequest,{responseType:isJSON?"":type,onload:function(){done(null,isText?xhr.responseText:isJSON?eval("("+xhr.responseText+")"):xhr.response)},onerror:function(){done(xhr)}});xhr.open("GET",url),xhr.send()}}(window.ModPlayer),function(a){"use strict";var b=a.format={},c=a.util,d=[];b.register=function(a,c){d.push(a),c&&(b["parse"+c]=a)},b.parseModule=function(a){for(var b=null,c=0;!b&&c<d.length;)b=d[c++](a);return b},b.bytesIter=function(a,b){function d(){return b}function e(a){return b+=Math.abs(a),h}function f(c){return String.fromCharCode.apply(null,a.subarray(b,b+=c))}function g(d,e){e=e===!0;var f=c.range(d).reduce(function(c,f){var g=a[b+f];return e&&f+1!==d||(g&=255),c+(g<<8*f)},0);return b+=d,f}b=b||0;var h={pos:d,step:e,str:f},i={"byte":1,word:2,dword:4};return Object.keys(i).forEach(function(a){h[a]=g.bind(null,i[a])}),h}}(window.ModPlayer),function(a){"use strict";function b(b){return c(a.format.bytesIter(b))}function c(b){var c={title:b.str(20).trim(),speed:125,tempo:6},i=a.util.range(31).map(function(){var c={name:b.str(22).trim()},d={sampLen:2*e(b),finetune:h[15&b.byte()],volume:b.byte(),loopStart:e(b),panning:128},f=2*e(b);d.loopEnd=d.loopStart+f,d.loopType=f>2?"forward":null;var i=a.util.constant(0);return d.sampLen>2&&(a.util.extend(c,{sampleMapping:g.range(96).map(i),volumeEnvelope:g.range(24).map(i),panningEnvelope:g.range(24).map(i),volumeEnvelopePoints:0,panningEnvelopePoints:0,volumeEnvelopeSustainPoint:0,volumeEnvelopeLoopStartPoint:0,volumeEnvelopeLoopEndPoint:0,panningEnvelopeSustainPoint:0,panningEnvelopeLoopStartPoint:0,panningEnvelopeLoopEndPoint:0,volumeType:0,panningType:0,vibratoType:0,vibratoSweep:0,vibratoDepth:0,vibratoRate:0,volumeFadeOut:0}),c.samples=[d]),c});c.instruments=i;var j=b.byte();b.step(1);var k=a.util.range(128).map(b.byte);c.patternOrder=k.slice(0,j),c.id=b.str(4),c.numChannels=f(c.id);var l=Math.max.apply(null,k),k=a.util.range(l).map(function(){for(var e=a.util.range(256*c.numChannels).map(b.byte),f=[],g=0;64>g;g++)for(var h=0;h<c.numChannels;h++){var i,j,k,l=4*(64*g+h),m=e[l],n=e[l+1],o=e[l+2],p=e[l+3];i=((15&m)<<8)+n,j=(240&m)+(o>>4),k=15&o,i=d(i),1!=k||p||(k=0),2!=k||p||(k=0),10!=k||p||(k=0),5!=k||p||(k=3),6!=k||p||(k=4),f.push(i,j,0,k,p)}return f});return c.patterns=k,c.instruments.forEach(function(c){if(c.samples){var d=c.samples[0];d.data=a.util.range(d.sampLen).map(b.byte)}}),c}function d(a){for(var b=0;120>b;b++){var c=16*i[b%12]>>b/12>>2;if(a>=c)return b+1}return 0}function e(a){return(a.byte()<<8)+a.byte()}function f(a){return{"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,OKTA:8,OCTA:8,FA08:8,CD81:8}[a]||parseInt(/(\d+)CH/.exec(a)[1],10)}var g=a.util;a.format.register(b,"PTModule");var h=[0,16,32,48,64,80,96,112,-128,-112,-96,-80,-64,-48,-32,-16],i=[1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,907]}(window.ModPlayer),function(a){"use strict";function b(b){if(!c(b))return null;var f=a.format.bytesIter(b),h=d(f);return k.extend(h,{patterns:j(e,h.patterns,f,h.numChannels),instruments:j(g,h.instruments,f)})}function c(b){return"Extended Module: "===a.format.bytesIter(b).str(17)}function d(a){var b={id:a.str(17),title:a.str(20).trim(),tracker:a.step(1).str(20).trim(),ver:a.word(),patternOrder:a.step(4).word(),restart:a.word(),numChannels:a.word(),patterns:a.word(),instruments:a.word(),freqTable:1&a.word()?"linear":"amiga",tempo:a.word(),speed:a.word()};return b.patternOrder=k.range(256).map(a.byte).slice(0,b.patternOrder),b}function e(a,b){var c;return a.step(5),c=a.word(),a.step(2),k.flatten(j(f,c*b,a))}function f(a){var b,c,d,e,f,g=a.byte();return 128&g?(b=c=d=e=f=0,1&g&&(b=a.byte()),2&g&&(c=a.byte()),4&g&&(d=a.byte()),8&g&&(e=a.byte()),16&g&&(f=a.byte())):(b=g,c=a.byte(),d=a.byte(),e=a.byte(),f=a.byte()),[b,c,d,e,f]}function g(a){function b(b){return b.data=i(a,b.sampLen,b.is16),b}var c={},d=a.pos(),e=a.dword(),f=a.str(22).trim(),g=a.step(1).word();return g>0&&(a.step(4),c={sampleMapping:k.range(96).map(a.byte),volumeEnvelope:k.range(24).map(a.word),panningEnvelope:k.range(24).map(a.word),volumeEnvelopePoints:a.byte(),panningEnvelopePoints:a.byte(),volumeEnvelopeSustainPoint:a.byte(),volumeEnvelopeLoopStartPoint:a.byte(),volumeEnvelopeLoopEndPoint:a.byte(),panningEnvelopeSustainPoint:a.byte(),panningEnvelopeLoopStartPoint:a.byte(),panningEnvelopeLoopEndPoint:a.byte(),volumeType:a.byte(),panningType:a.byte(),vibratoType:a.byte(),vibratoSweep:a.byte(),vibratoDepth:a.byte(),vibratoRate:a.byte(),volumeFadeOut:a.word()},a.step(e-(a.pos()-d)),c.samples=j(h,g,a).map(b)),c.name=f,c}function h(a){var b={sampLen:a.dword(),loopStart:a.dword(),loopEnd:a.dword(),volume:a.byte(),finetune:a.byte(!0),loopType:a.byte(),panning:a.byte(),relnote:a.byte(!0),name:a.step(1).str(22).trim()};return b.is16=!!(16&b.loopType),b}function i(a,b,c){c&&(b/=2);var d=c?a.word:a.byte,e=0;return k.range(b).map(function(){return e+=d(),e&=c?65535:255,c?e>=32768&&(e-=65536):e>=128&&(e-=256),e})}function j(a,b){var c=Array.from(arguments).slice(2);return k.range(b).map(function(){return a.apply(this,c)})}var k=a.util;a.format.register(b,"XModule")}(window.ModPlayer),function(a){"use strict";a.util.extend(a.prototype,{getPattern:function(a){return this.patterns[this.patternOrder[a]]},numPatterns:function(){return this.patternOrder.length},toJSON:function(){function b(b){return!a.util.startsWith(b,"_")}return a.util.pick(this,Object.keys(this).filter(b))}})}(window.ModPlayer);